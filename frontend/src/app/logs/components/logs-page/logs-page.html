<div class="container py-4">
  <div class="card shadow-sm">

    <!-- Header -->
    <div class="card-header bg-white">
      <h4 class="mb-0">Firewall Logs</h4>
    </div>

    <div class="card-body">

      <!-- üîµ IMPORTATION DES LOGS -->
      <div class="row g-3 mb-4 align-items-end">
        <div class="col-md-4">
          <input
            type="file"
            class="form-control"
            (change)="onFileSelected($event)"
          />
        </div>

        <div class="col-md-3">
          <select
            class="form-select"
            (change)="onFirewallTypeSelected($event)"
          >
            <option value="" disabled selected>-- Type de firewall --</option>
            <option *ngFor="let type of supportedTypes" [value]="type">{{ type }}</option>
          </select>
        </div>

        <div class="col-md-2">
          <button 
            class="btn btn-success w-100" 
            (click)="uploadLogs()"
            [disabled]="isUploading"
          >
            {{ isUploading ? 'Upload en cours...' : 'Importer' }}
          </button>
        </div>
      </div>

      <!-- üîµ R√âSULTATS DE L'UPLOAD -->
      <div *ngIf="uploadResult" class="mb-4">
        <p><strong>Logs trait√©s :</strong> {{ uploadResult.processed }}</p>
        <p><strong>Logs ignor√©s :</strong> {{ uploadResult.ignored }}</p>
        <div *ngIf="uploadResult.warning?.length">
          <p><strong>Avertissements :</strong></p>
          <ul>
            <li *ngFor="let w of uploadResult.warning">{{ w }}</li>
          </ul>
        </div>
      </div>

      <div *ngIf="errorMessage" class="alert alert-danger mb-4">
        {{ errorMessage }}
      </div>

      <!-- üîµ FILTRES & RECHERCHE -->
      <form #filterForm="ngForm" (ngSubmit)="search()" class="row g-3 mb-4">
        <div class="col-md-4">
          <input
            type="text"
            name="search"
            class="form-control"
            placeholder="Rechercher par IP ou message"
            [(ngModel)]="filters.search"
            #searchField="ngModel"
          />
        </div>

        <div class="col-md-3">
          <select
            class="form-select"
            name="action"
            [(ngModel)]="filters.action"
          >
            <option value="">Toutes les actions</option>
            <option value="ALLOW">ALLOW</option>
            <option value="DENY">DENY</option>
          </select>
        </div>

        <div class="col-md-2">
          <input
            type="date"
            name="from"
            class="form-control"
            [(ngModel)]="filters.from"
          />
        </div>

        <div class="col-md-2">
          <input
            type="date"
            name="to"
            class="form-control"
            [(ngModel)]="filters.to"
          />
        </div>

        <div class="col-md-1">
          <button type="submit" class="btn btn-primary w-100">
            Filtrer
          </button>
        </div>
      </form>

      <!-- üîµ TABLEAU DES LOGS -->
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th>Timestamp</th>
              <th>IP Source</th>
              <th>IP Destination</th>
              <th>Action</th>
              <th>Protocole</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let log of logs; trackBy: trackById">
              <td>{{ log.timestamp }}</td>
              <td>{{ log.srcIp }}</td>
              <td>{{ log.destIp }}</td>
              <td>
                <span class="badge" [ngClass]="{
                  'bg-success': log.action === 'ALLOW',
                  'bg-danger': log.action === 'DENY'
                }">
                  {{ log.action }}
                </span>
              </td>
              <td>{{ log.protocol }}</td>
            </tr>

            <tr *ngIf="logs.length === 0">
              <td colspan="5" class="text-center text-muted">
                Aucun log trouv√©
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- üîµ PAGINATION (simple) -->
      <nav *ngIf="total > limit" class="mt-3">
        <ul class="pagination justify-content-center">
          <li class="page-item" [class.disabled]="page === 1">
            <button class="page-link" (click)="changePage(page - 1)">Pr√©c</button>
          </li>
          <li class="page-item disabled">
  <span class="page-link">{{ page }} / {{ getTotalPages() }}</span>
</li>

          <li class="page-item" [class.disabled]="page >= total / limit">
            <button class="page-link" (click)="changePage(page + 1)">Suiv</button>
          </li>
        </ul>
      </nav>

    </div>
  </div>
</div>
