<div class="container py-4">
  <div class="card shadow-sm">

    <!-- Header -->
    <div class="card-header bg-white">
      <h4 class="mb-0">Firewall Logs</h4>
    </div>

    <div class="card-body">

      <!-- üîµ IMPORTATION DES LOGS -->
      <div class="row g-3 mb-4 align-items-end">
        <div class="col-md-6">
          <input
            type="file"
            class="form-control"
            (change)="onFileSelected($event)"
          />
        </div>
        <div class="col-md-2">
          <button class="btn btn-success w-100" (click)="uploadLogs()">
            Importer
          </button>
        </div>
      </div>

      <!-- üîµ FILTRES & RECHERCHE -->
      <form #filterForm="ngForm" (ngSubmit)="search()" class="row g-3 mb-4">
        <div class="col-md-4">
          <input
            type="text"
            name="search"
            class="form-control"
            placeholder="Rechercher par IP ou message"
            [(ngModel)]="filters.search"
            #searchField="ngModel"
            required
            minlength="1"
          />
          <div *ngIf="searchField.invalid && searchField.touched" class="text-danger small mt-1">
            Veuillez saisir au moins un caract√®re
          </div>
        </div>

        <div class="col-md-3">
          <select
            class="form-select"
            name="action"
            [(ngModel)]="filters.action"
          >
            <option value="">Toutes les actions</option>
            <option value="ALLOW">ALLOW</option>
            <option value="DENY">DENY</option>
          </select>
        </div>

        <div class="col-md-2">
          <input
            type="date"
            name="from"
            class="form-control"
            [(ngModel)]="filters.from"
          />
        </div>

        <div class="col-md-2">
          <input
            type="date"
            name="to"
            class="form-control"
            [(ngModel)]="filters.to"
          />
        </div>

        <div class="col-md-1">
          <button type="submit" class="btn btn-primary w-100" [disabled]="filterForm.invalid">
            Filtrer
          </button>
        </div>
      </form>

      <!-- üîµ TABLEAU DES LOGS -->
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th>Timestamp</th>
              <th>IP Source</th>
              <th>IP Destination</th>
              <th>Action</th>
              <th>Protocole</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let log of logs; trackBy: trackById">
              <td>{{ log.timestamp }}</td>
              <td>{{ log.srcIp }}</td>
              <td>{{ log.destIp }}</td>
              <td>
                <span class="badge" [ngClass]="{
                  'bg-success': log.action === 'ALLOW',
                  'bg-danger': log.action === 'DENY'
                }">
                  {{ log.action }}
                </span>
              </td>
              <td>{{ log.protocol }}</td>
            </tr>

            <tr *ngIf="logs.length === 0">
              <td colspan="5" class="text-center text-muted">
                Aucun log trouv√©
              </td>
            </tr>
          </tbody>
        </table>
      </div>

    </div>
  </div>
</div>
